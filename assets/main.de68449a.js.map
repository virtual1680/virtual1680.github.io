{"version":3,"file":"main.de68449a.js","sources":["../../src/components/basic-video/plugin.ts","../../src/components/basic-video/main.vue"],"sourcesContent":["export default class RecordVideo {\n\tvideo: HTMLVideoElement;\n\tmediaRecorder: MediaRecorder | null;\n\tchunks: BlobPart[];\n\t/**\n\t * 构造函数\n\t *\n\t * @param  {Object}   videoObj 视频对象\n\t */\n\tconstructor(videoObj: HTMLVideoElement) {\n\t\tthis.video = videoObj;\n\t\tthis.mediaRecorder = null;\n\t\tthis.chunks = [];\n\t}\n\n\t/**\n\t * 初始化\n\t *\n\t * @return {Object} promise\n\t */\n\tinit() {\n\t\t// 返回Promise对象\n\t\t// resolve 正常处理\n\t\t// reject 处理异常情况\n\t\treturn new Promise((resolve: (value?: unknown) => void, reject) => {\n\t\t\tnavigator.mediaDevices\n\t\t\t\t.getUserMedia({\n\t\t\t\t\taudio: true,\n\t\t\t\t\tvideo: true\n\t\t\t\t\t// video: {\n\t\t\t\t\t//     width: this.videoWidth,\n\t\t\t\t\t//     height: this.videoHeight\n\t\t\t\t\t// }\n\t\t\t\t})\n\t\t\t\t// 返回一个媒体内容的流\n\t\t\t\t.then(stream => {\n\t\t\t\t\t// 检测是否支持 srcObject，该属性在新的浏览器支持\n\t\t\t\t\tif ('srcObject' in this.video) {\n\t\t\t\t\t\tthis.video.srcObject = stream;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// 兼容旧的浏览器\n\t\t\t\t\t\t// this.video.src = window.URL.createObjectURL(stream);\n\t\t\t\t\t}\n\n\t\t\t\t\t// 当视频的元数据已经加载时触发\n\t\t\t\t\tthis.video.addEventListener('loadmetadata', () => {\n\t\t\t\t\t\tthis.video.play();\n\t\t\t\t\t});\n\t\t\t\t\tthis.mediaRecorder = new MediaRecorder(stream);\n\t\t\t\t\t// TODO\n\t\t\t\t\tthis.mediaRecorder.addEventListener('dataavailable', (e: Event & { data: BlobPart }) => {\n\t\t\t\t\t\tthis.chunks.push(e.data);\n\t\t\t\t\t});\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t// 异常抓取，包括用于禁用麦克风、摄像头\n\t\t\t\t.catch(error => {\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * 视频开始录制\n\t */\n\tstartRecord() {\n\t\tif (this.mediaRecorder?.state === 'inactive') {\n\t\t\tthis.mediaRecorder.start();\n\t\t}\n\t}\n\n\t/**\n\t * 视频结束录制\n\t */\n\tstopRecord() {\n\t\tif (this.mediaRecorder?.state === 'recording') {\n\t\t\tthis.mediaRecorder.stop();\n\t\t}\n\t}\n\n\t/**\n\t * 检测当前浏览器对否支持\n\t *\n\t * @return {boolean} 当前浏览器是否支持\n\t */\n\tasync isSupport() {\n\t\t// TODO\n\t\tconst flag = navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\n\t\tif (await flag()) {\n\t\t\treturn true;\n\t\t}\n\t}\n}\n","<template>\n\t<div :style=\"styleName\" class=\"basic-video\">\n\t\t<div class=\"basic-video__border\">\n\t\t\t<span :style=\"borderStyleName\"></span>\n\t\t\t<span :style=\"borderStyleName\"></span>\n\t\t\t<span :style=\"borderStyleName\"></span>\n\t\t\t<span :style=\"borderStyleName\"></span>\n\t\t</div>\n\t\t<img :style=\"imgStyleName\" class=\"basic-video__img\" :src=\"background\" />\n\t\t<video class=\"basic-video__main\" ref=\"videoRef\" autoplay muted></video>\n\t</div>\n</template>\n\n<script lang=\"ts\" setup name=\"basic-video\">\nimport { computed, Ref, ref, onMounted } from 'vue';\nimport RecordVideo from './plugin';\nconst videoRef: Ref<HTMLVideoElement | null> = ref(null);\nconst emit = defineEmits<{ (e: 'data-change', value: string | ArrayBuffer | null): void }>();\nconst props = defineProps({\n\tbackground: {\n\t\ttype: String\n\t},\n\twidth: {\n\t\ttype: Number,\n\t\tdefault: 500\n\t}\n});\nconst styleName = computed(() => {\n\treturn {\n\t\twidth: `${props.width}px`\n\t};\n});\nconst imgStyleName = computed(() => {\n\treturn {\n\t\twidth: `${props.width / 2}px`\n\t};\n});\nconst borderStyleName = computed(() => {\n\treturn {\n\t\twidth: `${props.width / 15}px`,\n\t\theight: `${props.width / 15}px`,\n\t\tborderWidth: `${5}px`\n\t};\n});\nconst videoObj: Ref<RecordVideo | null> = ref(null);\nconst init = () => {\n\tvideoObj.value = new RecordVideo(videoRef.value!);\n\tconst videoPromise = videoObj.value.init();\n\tvideoPromise.then(() => {\n\t\tvideoObj.value?.mediaRecorder?.addEventListener('stop', getData, false);\n\t});\n};\n// const startRecord = () => {\n// \tvideoObj.value.startRecord();\n// };\n// const stopRecord = () => {\n// \tvideoObj.value.stopRecord();\n// };\nconst getData = () => {\n\tconst blob = new Blob(videoObj.value?.chunks, {\n\t\ttype: 'video/mp4'\n\t});\n\tconst reader = new FileReader();\n\treader.readAsDataURL(blob);\n\treader.addEventListener('loadend', () => {\n\t\tlet video_base64 = reader.result;\n\t\temit('data-change', video_base64);\n\t});\n};\nonMounted(() => {\n\tinit();\n});\n</script>\n<style lang=\"scss\" scoped>\n.basic-video {\n\tposition: relative;\n\tmargin: 0 auto;\n\toverflow: hidden;\n\t&__border {\n\t\tspan {\n\t\t\tposition: absolute;\n\t\t\twidth: 30px;\n\t\t\theight: 30px;\n\t\t\tcolor: #0073eb;\n\t\t\tborder-style: solid;\n\t\t\tborder-width: 4px;\n\t\t\t&:nth-child(1) {\n\t\t\t\ttop: 15px;\n\t\t\t\tleft: 15px;\n\t\t\t\tborder-right: 0;\n\t\t\t\tborder-bottom: 0;\n\t\t\t}\n\t\t\t&:nth-child(2) {\n\t\t\t\ttop: 15px;\n\t\t\t\tright: 15px;\n\t\t\t\tborder-bottom: 0;\n\t\t\t\tborder-left: 0;\n\t\t\t}\n\t\t\t&:nth-child(3) {\n\t\t\t\tbottom: 15px;\n\t\t\t\tleft: 15px;\n\t\t\t\tborder-top: 0;\n\t\t\t\tborder-right: 0;\n\t\t\t}\n\t\t\t&:nth-child(4) {\n\t\t\t\tright: 15px;\n\t\t\t\tbottom: 15px;\n\t\t\t\tborder-top: 0;\n\t\t\t\tborder-left: 0;\n\t\t\t}\n\t\t}\n\t}\n\t&__img {\n\t\tposition: absolute;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\twidth: 100px;\n\t\ttransform: translate(-50%, -50%);\n\t}\n\t&__main {\n\t\twidth: 100%;\n\t}\n}\n</style>\n"],"names":["RecordVideo","constructor","videoObj","__publicField","this","video","mediaRecorder","chunks","init","Promise","resolve","reject","navigator","mediaDevices","getUserMedia","audio","then","stream","srcObject","addEventListener","play","MediaRecorder","e","push","data","catch","error","startRecord","_a","state","start","stopRecord","stop","async","flag","videoRef","Vue","styleName","width","props","imgStyleName","borderStyleName","height","borderWidth","getData","blob","Blob","value","type","reader","FileReader","readAsDataURL","video_base64","result","emit","onMounted","_b"],"mappings":"wMAAA,MAAqBA,EASpBC,YAAYC,GARZC,EAAAC,KAAA,SACAD,EAAAC,KAAA,iBACAD,EAAAC,KAAA,UAOCA,KAAKC,MAAQH,EACbE,KAAKE,cAAgB,KACrBF,KAAKG,OAAS,GAQfC,OAIC,OAAO,IAAIC,SAAQ,CAACC,EAAoCC,KACvDC,UAAUC,aACRC,aAAa,CACbC,OAAO,EACPV,OAAO,IAOPW,MAAeC,IAEX,cAAeb,KAAKC,QACvBD,KAAKC,MAAMa,UAAYD,GAOnBb,KAAAC,MAAMc,iBAAiB,gBAAgB,KAC3Cf,KAAKC,MAAMe,UAEPhB,KAAAE,cAAgB,IAAIe,cAAcJ,GAEvCb,KAAKE,cAAca,iBAAiB,iBAAkBG,IAChDlB,KAAAG,OAAOgB,KAAKD,EAAEE,gBAKpBC,OAAeC,IACff,EAAOe,SAQXC,oBACmC,cAA9B,OAAKC,EAAAxB,KAAAE,oBAAe,EAAAsB,EAAAC,QACvBzB,KAAKE,cAAcwB,QAOrBC,mBACmC,eAA9B,OAAKH,EAAAxB,KAAAE,oBAAe,EAAAsB,EAAAC,QACvBzB,KAAKE,cAAc0B,OASrBC,kBAEC,MAAMC,EAAOtB,UAAUC,cAAgBD,UAAUC,aAAaC,aAC1D,SAAMoB,IACF,OAAA,oPCzEVC,EAAAC,cAWAC,EAAAD,mBACA,CAAAE,MAAA,GAAAC,EAAAD,cAIAE,EAAAJ,mBACA,CAAAE,MAAAC,EAAAD,MAAA,EAAA,SAIAG,EAAAL,mBACA,CAAAE,MAAAC,EAAAD,MAAA,GAAA,KACAI,OAAAH,EAAAD,MAAA,GAAA,KACAK,YAAA,UAIAzC,EAAAkC,cAcAQ,EAAA,WACA,MAAAC,EAAA,IAAAC,KAAA,OAAAlB,EAAA1B,EAAA6C,gBAAAxC,OAAA,CAAAyC,KAAA,cAGAC,EAAA,IAAAC,WACAD,EAAAE,cAAAN,GACAI,EAAA9B,iBAAA,WAAA,KACA,IAAAiC,EAAAH,EAAAI,OACAC,EAAA,cAAAF,cAGAhB,IAAAmB,WAAA,KAvBArD,EAAA6C,MAAA,IAAA/C,EAAAmC,EAAAY,OACA7C,EAAA6C,MAAAvC,OACAQ,MAAA,aACA,OAAAwC,EAAA,OAAA5B,EAAA1B,EAAA6C,YAAA,EAAAnB,EAAAtB,gBAAAkD,EAAArC,iBAAA,OAAAyB,GAAA"}