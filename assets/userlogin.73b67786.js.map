{"version":3,"file":"userlogin.73b67786.js","sources":["../../src/page/login/userlogin.vue"],"sourcesContent":["<template>\r\n\t<el-form class=\"login-form\" status-icon :rules=\"loginRules\" ref=\"ruleFormRef\" :model=\"loginForm\" label-width=\"0\">\r\n\t\t<el-form-item prop=\"username\">\r\n\t\t\t<el-input @keyup.enter=\"handleLogin\" v-model=\"loginForm.username\" auto-complete=\"off\" :placeholder=\"$t('login.username')\">\r\n\t\t\t\t<template #prefix>\r\n\t\t\t\t\t<i class=\"icon-yonghu\"></i>\r\n\t\t\t\t</template>\r\n\t\t\t</el-input>\r\n\t\t</el-form-item>\r\n\t\t<el-form-item prop=\"password\">\r\n\t\t\t<el-input @keyup.enter=\"handleLogin\" :type=\"passwordType\" v-model=\"loginForm.password\" auto-complete=\"off\" :placeholder=\"$t('login.password')\">\r\n\t\t\t\t<template #suffix>\r\n\t\t\t\t\t<i class=\"el-icon-view el-input__icon\" @click=\"showPassword\"></i>\r\n\t\t\t\t</template>\r\n\t\t\t\t<template #prefix>\r\n\t\t\t\t\t<i class=\"icon-mima\"></i>\r\n\t\t\t\t</template>\r\n\t\t\t</el-input>\r\n\t\t</el-form-item>\r\n\t\t<el-form-item prop=\"code\">\r\n\t\t\t<el-input @keyup.enter=\"handleLogin\" :maxlength=\"code.len\" v-model=\"loginForm.code\" auto-complete=\"off\" :placeholder=\"$t('login.code')\">\r\n\t\t\t\t<template #prefix>\r\n\t\t\t\t\t<i class=\"icon-yanzhengma\"></i>\r\n\t\t\t\t</template>\r\n\t\t\t\t<template #append>\r\n\t\t\t\t\t<div class=\"login-code\">\r\n\t\t\t\t\t\t<span class=\"login-code-img\" @click=\"refreshCode\" v-if=\"code.type == 'text'\">{{ code.value }}</span>\r\n\t\t\t\t\t\t<img :src=\"code.src\" class=\"login-code-img\" @click=\"refreshCode\" v-else />\r\n\t\t\t\t\t\t<!-- <i class=\"icon-shuaxin login-code-icon\" @click=\"refreshCode\"></i> -->\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</template>\r\n\t\t\t</el-input>\r\n\t\t</el-form-item>\r\n\r\n\t\t<el-form-item>\r\n\t\t\t<el-button type=\"primary\" @click.prevent=\"handleLogin(ruleFormRef)\" class=\"login-submit\">{{ $t('login.submit') }}</el-button>\r\n\t\t</el-form-item>\r\n\t</el-form>\r\n</template>\r\n\r\n<script lang=\"ts\" setup name=\"UserLogin\">\r\nimport { reactive, ref } from 'vue';\r\nimport { randomLenNum } from 'utils/util';\r\nimport { FormInstance } from 'element-plus';\r\nimport { useUserStore, useTagsStore } from 'store/index';\r\nimport { useRouter } from 'vue-router';\r\nconst router = useRouter();\r\nconst uStore = useUserStore();\r\nconst tStore = useTagsStore();\r\nlet loginForm = reactive({\r\n\tusername: 'admin',\r\n\tpassword: '123456',\r\n\tcode: '',\r\n\tredomStr: ''\r\n});\r\nlet code = reactive({\r\n\tsrc: '',\r\n\tvalue: '',\r\n\tlen: 4,\r\n\ttype: 'text'\r\n});\r\nconst passwordType = ref('password');\r\n// const checked = ref(false);\r\nconst ruleFormRef = ref<FormInstance>();\r\n\r\nconst refreshCode = () => {\r\n\tloginForm.redomStr = randomLenNum(code.len, true);\r\n\tcode.type == 'text' ? (code.value = randomLenNum(code.len, false)) : (code.src = `/${loginForm.redomStr}`);\r\n\tloginForm.code = code.value;\r\n};\r\n\r\nconst validateCode = (_: unknown, value: string, callback: (error?: Error) => void) => {\r\n\tif (code.value != value) {\r\n\t\tloginForm.code = '';\r\n\t\trefreshCode();\r\n\t\tcallback(new Error('请输入正确的验证码'));\r\n\t} else {\r\n\t\tcallback();\r\n\t}\r\n};\r\nconst loginRules = {\r\n\tusername: [{ required: true, message: '请输入用户名', trigger: 'blur' }],\r\n\tpassword: [\r\n\t\t{ required: true, message: '请输入密码', trigger: 'blur' },\r\n\t\t{ min: 6, message: '密码长度最少为6位', trigger: 'blur' }\r\n\t],\r\n\tcode: [\r\n\t\t{ required: true, message: '请输入验证码', trigger: 'blur' },\r\n\t\t{ min: 4, max: 4, message: '验证码长度为4位', trigger: 'blur' },\r\n\t\t{ required: true, trigger: 'blur', validator: validateCode }\r\n\t]\r\n};\r\nrefreshCode();\r\nconst showPassword = () => {\r\n\tpasswordType.value == '' ? (passwordType.value = 'password') : (passwordType.value = '');\r\n};\r\nconst handleLogin = async (formEl: FormInstance | undefined) => {\r\n\tif (!formEl) return;\r\n\tawait formEl.validate((valid, fields) => {\r\n\t\tif (valid) {\r\n\t\t\tuStore.LoginByUsername(loginForm).then(() => {\r\n\t\t\t\trouter.push(tStore.getTagWel);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole.log('error submit!', fields);\r\n\t\t}\r\n\t});\r\n};\r\n\r\n// ...mapState(['tagWel'])\r\n</script>\r\n\r\n<style></style>\r\n"],"names":["router","VueRouter","useRouter","uStore","useUserStore","tStore","useTagsStore","loginForm","Vue","reactive","username","password","code","redomStr","src","value","len","type","passwordType","ruleFormRef","ref","refreshCode","randomLenNum","loginRules","required","message","trigger","min","max","validator","_","callback","Error","showPassword","handleLogin","async","formEl","validate","valid","fields","LoginByUsername","then","push","getTagWel"],"mappings":"kWA8CA,MAAAA,EAAAC,UAAAC,YACAC,EAAAC,IACAC,EAAAC,IACA,IAAAC,EAAAC,IAAAC,SAAA,CAAAC,SAAA,QACAC,SAAA,SACAC,KAAA,GACAC,SAAA,KAGAD,EAAAJ,IAAAC,SAAA,CAAAK,IAAA,GACAC,MAAA,GACAC,IAAA,EACAC,KAAA,SAGA,MAAAC,EAAAV,oBAEAW,EAAAX,IAAAY,MAEAC,EAAA,KACAd,EAAAM,SAAAS,EAAAV,EAAAI,KAAA,GACA,QAAAJ,EAAAK,KAAAL,EAAAG,MAAAO,EAAAV,EAAAI,KAAA,GAAAJ,EAAAE,IAAA,IAAAP,EAAAM,WACAN,EAAAK,KAAAA,EAAAG,OAYAQ,EAAA,CAAAb,SAAA,CAAA,CAAAc,UAAA,EAAAC,QAAA,SAAAC,QAAA,SACAf,SAAA,CACA,CAAAa,UAAA,EAAAC,QAAA,QAAAC,QAAA,QACA,CAAAC,IAAA,EAAAF,QAAA,YAAAC,QAAA,SAEAd,KAAA,CACA,CAAAY,UAAA,EAAAC,QAAA,SAAAC,QAAA,QACA,CAAAC,IAAA,EAAAC,IAAA,EAAAH,QAAA,WAAAC,QAAA,QACA,CAAAF,UAAA,EAAAE,QAAA,OAAAG,UAjBA,CAAAC,EAAAf,EAAAgB,KACAnB,EAAAG,OAAAA,GACAR,EAAAK,KAAA,OAEAmB,EAAA,IAAAC,MAAA,2BAkBA,MAAAC,EAAA,KACA,IAAAf,EAAAH,MAAAG,EAAAH,MAAA,WAAAG,EAAAH,MAAA,IAEAmB,EAAAC,MAAAC,IACAA,SACAA,EAAAC,UAAA,CAAAC,EAAAC,KACAD,GACAnC,EAAAqC,gBAAAjC,GAAAkC,MAAA,KACAzC,EAAA0C,KAAArC,EAAAsC"}