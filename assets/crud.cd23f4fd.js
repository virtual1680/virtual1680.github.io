import{j as e,k as t,h as u}from"./index.6518f95b.js";function a(u){if(!e(u))return!1;var a=t(u);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a}let r={"../option/crud/index.ts":()=>u((()=>import("./index.a9ffe0a1.js")),[])},n={"../api/auth.ts":()=>u((()=>import("./auth.c8280b45.js")),["assets/auth.c8280b45.js","assets/index.6518f95b.js","assets/index.2b38ed39.css"]),"../api/user.ts":()=>u((()=>import("./index.6518f95b.js").then((function(e){return e.m}))),["assets/index.6518f95b.js","assets/index.2b38ed39.css"]),"../api/crud/index.ts":()=>u((()=>import("./index.07171b76.js")),["assets/index.07171b76.js","assets/index.6518f95b.js","assets/index.2b38ed39.css"])};const o=Vue.defineComponent({__name:"crud",setup(e){let{bindVal:t,onEvent:u,page:o,form:l,crud:s}=(e=>{let t=r[`../option/${e.sourcePath}.ts`],u=n[`../api/${e.sourcePath}.ts`];const o=Vue.ref([]);let l=Vue.ref({}),s=Vue.reactive({}),c=Vue.ref({}),d=Vue.reactive({}),i=Vue.ref(),f=Vue.ref(!1);const p=Vue.ref({current:1,size:20,total:0}),V=Vue.computed((()=>({ref:"crud",option:c.value,data:o.value,tableLoading:f.value}))),v=Vue.computed((()=>({"size-change":x,"current-change":A,"row-save":_,"row-update":g,"row-del":E,"refresh-change":b,"search-reset":P,"search-change":P}))),m=Vue.computed((()=>e.rowKey||"id"));t().then((e=>{c.value=e.default()})),u().then((e=>{d=e,h()}));const h=()=>{a(e.listBefore)&&e.listBefore(),(()=>{f.value=!0;const t=Object.assign({current:p.value.current,size:p.value.size},s);o.value=[],d[e.list||"list"](t).then((t=>{let u;f.value=!1,u=e.res?e.res(t.data):t.data,p.value.total=u[e.totalKey||"total"];const r=u[e.dataKey||"data"];o.value=r,a(e.listAfter)&&e.listAfter(u)})).finally((()=>{f.value=!1}))})()},_=(t,u,a)=>{e.addBefore&&e.addBefore(),Reflect.deleteProperty(l.value,"params"),d[e.add||"add"](l.value).then((t=>{h(),e.addAfter?e.addAfter(t):ElementPlus.ElMessage.success("新增成功"),u()})).catch((()=>{a()}))},g=(t,u,a,r)=>{e.updateBefore&&e.updateBefore(),Reflect.deleteProperty(l.value,"params"),d[e.update||"update"](l.value).then((t=>{h(),e.updateAfter?e.updateAfter(t):ElementPlus.ElMessage.success("更新成功"),a()})).catch((()=>{r()}))},E=(t,u)=>{const a=()=>{d[e.del||"del"](t[m.value],t).then((a=>{h(),e.delAfter?e.delAfter(a,t,u):ElementPlus.ElMessage.success("删除成功")}))};e.delBefore?(e.delBefore(),a()):ElementPlus.ElMessageBox.confirm(`此操作将永久删除序号【${u}】的数据, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{a()}))},P=(e,t)=>{t&&t(),p.value.current=1,h()},b=()=>{h()},x=e=>{p.value.current=1,p.value.size=e,h()},A=e=>{p.value.current=e,h()};return V.value.option,{bindVal:V,onEvent:v,rowKey:m,crud:i,refreshChange:b,page:p,form:l}})({sourcePath:"crud/index"});return Vue.onMounted((()=>{s.value})),(e,a)=>{const r=Vue.resolveComponent("avue-crud"),n=Vue.resolveComponent("basic-container");return Vue.openBlock(),Vue.createBlock(n,null,{default:Vue.withCtx((()=>[Vue.createVNode(r,Vue.mergeProps(Vue.unref(t),Vue.toHandlers(Vue.unref(u)),{page:Vue.unref(o),"onUpdate:page":a[0]||(a[0]=e=>Vue.isRef(o)?o.value=e:o=e),modelValue:Vue.unref(l),"onUpdate:modelValue":a[1]||(a[1]=e=>Vue.isRef(l)?l.value=e:l=e)}),null,16,["page","modelValue"])])),_:1})}}});export{o as default};
//# sourceMappingURL=crud.cd23f4fd.js.map
