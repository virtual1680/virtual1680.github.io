{"version":3,"file":"codelogin.0c8cb355.js","sources":["../../src/page/login/codelogin.vue"],"sourcesContent":["<template>\n\t<el-form class=\"login-form\" status-icon :rules=\"loginRules\" ref=\"loginForm\" :model=\"loginForm\" label-width=\"0\">\n\t\t<el-form-item prop=\"phone\">\n\t\t\t<el-input @keyup.enter=\"handleLogin\" v-model=\"loginForm.phone\" auto-complete=\"off\" :placeholder=\"$t('login.phone')\">\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<i class=\"icon-shouji\"></i>\n\t\t\t\t</template>\n\t\t\t</el-input>\n\t\t</el-form-item>\n\t\t<el-form-item prop=\"code\">\n\t\t\t<el-input @keyup.enter=\"handleLogin\" v-model=\"loginForm.code\" auto-complete=\"off\" :placeholder=\"$t('login.code')\">\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<i class=\"icon-yanzhengma\"></i>\n\t\t\t\t</template>\n\t\t\t\t<template #append>\n\t\t\t\t\t<span @click=\"handleSend\" class=\"msg-text\" :class=\"[{ display: msgKey }]\">{{ msgText }}</span>\n\t\t\t\t</template>\n\t\t\t</el-input>\n\t\t</el-form-item>\n\t\t<el-form-item>\n\t\t\t<el-button type=\"primary\" @click.prevent=\"handleLogin\" class=\"login-submit\">{{ $t('login.submit') }}</el-button>\n\t\t</el-form-item>\n\t</el-form>\n</template>\n\n<script lang=\"ts\" setup name=\"CodeLogin\">\nimport { isvalidatemobile } from 'utils/validate';\n// import { tagsStore } from '../../store/tags';\nimport { computed, reactive, ref } from 'vue';\nimport { FormInstance } from 'element-plus';\n// import { useRouter } from 'vue-router';\n// import { userStore } from '../../store/user';\nimport { useI18n } from 'app/lang/index';\n// const tStore = tagsStore();\n// const router = useRouter();\n// const uStore = userStore();\nconst i18n = useI18n();\nconst validatePhone = (rule: unknown, value: string, callback: (error?: Error) => void) => {\n\tif (isvalidatemobile(value)[0]) {\n\t\tcallback(new Error(isvalidatemobile(value)[1].toString()));\n\t} else {\n\t\tcallback();\n\t}\n};\nconst validateCode = (rule: unknown, value: string, callback: (error?: Error) => void) => {\n\tif (value.length != 4) {\n\t\tcallback(new Error('请输入4位数的验证码'));\n\t} else {\n\t\tcallback();\n\t}\n};\nconst msgText = ref('');\nconst msgTime = ref(0);\nconst msgKey = ref(false);\nlet loginForm = reactive({\n\tphone: '',\n\tcode: ''\n});\n\nconst loginRules = {\n\tphone: [{ required: true, trigger: 'blur', validator: validatePhone }],\n\tcode: [{ required: true, trigger: 'blur', validator: validateCode }]\n};\n\nconst config = computed(() => {\n\treturn {\n\t\t//TODO $t 已注册在全局，此取法有待优化\n\t\tMSGINIT: i18n.$t('login.msgText'),\n\t\tMSGSCUCCESS: i18n.$t('login.msgSuccess'),\n\t\tMSGTIME: 60\n\t};\n});\n// ...mapState(tagsStore(), ['tagWel']),\nmsgText.value = config.value.MSGINIT;\nmsgTime.value = config.value.MSGTIME;\n\nconst handleSend = () => {\n\tif (msgKey.value) return;\n\tmsgText.value = msgTime.value + config.value.MSGSCUCCESS;\n\tmsgKey.value = true;\n\tconst time = setInterval(() => {\n\t\tmsgTime.value--;\n\t\tmsgText.value = msgTime.value + config.value.MSGSCUCCESS;\n\t\tif (msgTime.value == 0) {\n\t\t\tmsgTime.value = config.value.MSGTIME;\n\t\t\tmsgText.value = config.value.MSGINIT;\n\t\t\tmsgKey.value = false;\n\t\t\tclearInterval(time);\n\t\t}\n\t}, 1000);\n};\n\nconst handleLogin = async (formEl: FormInstance | undefined) => {\n\tif (!formEl) return;\n\tawait formEl.validate((valid: boolean) => {\n\t\tif (valid) {\n\t\t\t// uStore.LoginByPhone(loginForm).then(() => {\n\t\t\t// \trouter.push(tStore.getTagWel);\n\t\t\t// });\n\t\t}\n\t});\n};\n</script>\n\n<style>\n.msg-text {\n\tdisplay: block;\n\twidth: 60px;\n\tfont-size: 12px;\n\ttext-align: center;\n\tcursor: pointer;\n}\n.msg-text.display {\n\tcolor: #ccc;\n}\n</style>\n"],"names":["i18n","useI18n","msgText","Vue","msgTime","msgKey","loginForm","reactive","phone","code","loginRules","required","trigger","validator","rule","value","callback","isvalidatemobile","Error","toString","length","config","MSGINIT","$t","MSGSCUCCESS","MSGTIME","handleSend","time","setInterval","clearInterval","handleLogin","async","formEl","validate","valid"],"mappings":"gQAoCA,MAAAA,EAAAC,IAeAC,EAAAC,YACAC,EAAAD,WACAE,EAAAF,YACA,IAAAG,EAAAH,IAAAI,SAAA,CAAAC,MAAA,GACAC,KAAA,KAIA,MAAAC,EAAA,CAAAF,MAAA,CAAA,CAAAG,UAAA,EAAAC,QAAA,OAAAC,UAtBA,CAAAC,EAAAC,EAAAC,KACAC,EAAAF,GAAA,GACAC,EAAA,IAAAE,MAAAD,EAAAF,GAAA,GAAAI,oBAqBAV,KAAA,CAAA,CAAAE,UAAA,EAAAC,QAAA,OAAAC,UAhBA,CAAAC,EAAAC,EAAAC,KACA,GAAAD,EAAAK,OACAJ,EAAA,IAAAE,MAAA,uBAkBAG,EAAAlB,mBACA,CAAAmB,QAAAtB,EAAAuB,GAAA,iBAEAC,YAAAxB,EAAAuB,GAAA,oBACAE,QAAA,OAKAvB,EAAAa,MAAAM,EAAAN,MAAAO,QACAlB,EAAAW,MAAAM,EAAAN,MAAAU,QAEA,MAAAC,EAAA,KACA,GAAArB,EAAAU,MAAA,OACAb,EAAAa,MAAAX,EAAAW,MAAAM,EAAAN,MAAAS,YACAnB,EAAAU,OAAA,EACA,MAAAY,EAAAC,aAAA,KACAxB,EAAAW,QACAb,EAAAa,MAAAX,EAAAW,MAAAM,EAAAN,MAAAS,YACA,GAAApB,EAAAW,QACAX,EAAAW,MAAAM,EAAAN,MAAAU,QACAvB,EAAAa,MAAAM,EAAAN,MAAAO,QACAjB,EAAAU,OAAA,EACAc,cAAAF,MACA,MAIAG,EAAAC,MAAAC,IACAA,SACAA,EAAAC,UAAAC"}