import{j as e,k as t,h as a}from"./index.1f3af114.js";function u(a){if(!e(a))return!1;var u=t(a);return"[object Function]"==u||"[object GeneratorFunction]"==u||"[object AsyncFunction]"==u||"[object Proxy]"==u}let r={"../option/crud/index.ts":()=>a((()=>import("./index.a9ffe0a1.js")),[])},n={"../api/auth.ts":()=>a((()=>import("./auth.264ef17b.js")),["assets/auth.264ef17b.js","assets/index.1f3af114.js","assets/index.f58093cb.css"]),"../api/user.ts":()=>a((()=>import("./index.1f3af114.js").then((function(e){return e.m}))),["assets/index.1f3af114.js","assets/index.f58093cb.css"]),"../api/crud/index.ts":()=>a((()=>import("./index.3c72ec77.js")),["assets/index.3c72ec77.js","assets/index.1f3af114.js","assets/index.f58093cb.css"])};const o=Vue.defineComponent({__name:"crud",setup(e){let{bindVal:t,onEvent:a,page:o,form:l,crud:s}=(e=>{let t=r[`../option/${e.sourcePath}.ts`],a=n[`../api/${e.sourcePath}.ts`];const o=Vue.ref([]);let l=Vue.ref({}),s=Vue.reactive({}),c=Vue.ref({}),d=Vue.reactive({}),i=Vue.ref(),f=Vue.ref(!1);const p=Vue.ref({current:1,size:20,total:0}),V=Vue.computed((()=>({ref:"crud",option:c.value,data:o.value,tableLoading:f.value}))),v=Vue.computed((()=>({"size-change":A,"current-change":B,"row-save":_,"row-update":g,"row-del":E,"refresh-change":x,"search-reset":P,"search-change":P}))),m=Vue.computed((()=>e.rowKey||"id"));t().then((e=>{c.value=e.default()})),a().then((e=>{d=e,h()}));const h=()=>{u(e.listBefore)&&e.listBefore(),(()=>{f.value=!0;const t=Object.assign({current:p.value.current,size:p.value.size},s);o.value=[],d[e.list||"list"](t).then((t=>{let a;f.value=!1,a=e.res?e.res(t.data):t.data,p.value.total=a[e.totalKey||"total"];const r=a[e.dataKey||"data"];o.value=r,u(e.listAfter)&&e.listAfter(a)})).finally((()=>{f.value=!1}))})()},_=(t,a,u)=>{e.addBefore&&e.addBefore(),Reflect.deleteProperty(l.value,"params"),d[e.add||"add"](l.value).then((t=>{h(),e.addAfter?e.addAfter(t):ElementPlus.ElMessage.success("新增成功"),a()})).catch((()=>{u()}))},g=(t,a,u,r)=>{e.updateBefore&&e.updateBefore(),Reflect.deleteProperty(l.value,"params"),d[e.update||"update"](l.value).then((t=>{h(),e.updateAfter?e.updateAfter(t):ElementPlus.ElMessage.success("更新成功"),u()})).catch((()=>{r()}))},E=(t,a)=>{const u=()=>{d[e.del||"del"](t[m.value],t).then((u=>{h(),e.delAfter?e.delAfter(u,t,a):ElementPlus.ElMessage.success("删除成功")}))};e.delBefore?(e.delBefore(),u()):ElementPlus.ElMessageBox.confirm(`此操作将永久删除序号【${a}】的数据, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{u()}))},P=(e,t)=>{t&&t(),p.value.current=1,h()},x=()=>{h()},A=e=>{p.value.current=1,p.value.size=e,h()},B=e=>{p.value.current=e,h()};return V.value.option,{bindVal:V,onEvent:v,rowKey:m,crud:i,refreshChange:x,page:p,form:l}})({sourcePath:"crud/index"});return Vue.onMounted((()=>{s.value})),(e,u)=>{const r=Vue.resolveComponent("avue-crud"),n=Vue.resolveComponent("basic-container");return Vue.openBlock(),Vue.createBlock(n,null,{default:Vue.withCtx((()=>[Vue.createVNode(r,Vue.mergeProps(Vue.unref(t),Vue.toHandlers(Vue.unref(a)),{page:Vue.unref(o),"onUpdate:page":u[0]||(u[0]=e=>Vue.isRef(o)?o.value=e:o=e),modelValue:Vue.unref(l),"onUpdate:modelValue":u[1]||(u[1]=e=>Vue.isRef(l)?l.value=e:l=e)}),null,16,["page","modelValue"])])),_:1})}}});export{o as default};
//# sourceMappingURL=crud.4153f38f.js.map
