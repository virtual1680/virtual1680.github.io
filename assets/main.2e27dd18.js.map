{"version":3,"file":"main.2e27dd18.js","sources":["../../src/components/basic-video/plugin.ts","../../src/components/basic-video/main.vue"],"sourcesContent":["export default class RecordVideo {\r\n\tvideo: any;\r\n\tmediaRecorder: any;\r\n\tchunks: any[];\r\n\t/**\r\n\t * 构造函数\r\n\t *\r\n\t * @param  {Object}   videoObj 视频对象\r\n\t */\r\n\tconstructor(videoObj: any) {\r\n\t\tthis.video = videoObj;\r\n\t\tthis.mediaRecorder = null;\r\n\t\tthis.chunks = [];\r\n\t}\r\n\r\n\t/**\r\n\t * 初始化\r\n\t *\r\n\t * @return {Object} promise\r\n\t */\r\n\tinit() {\r\n\t\t// 返回Promise对象\r\n\t\t// resolve 正常处理\r\n\t\t// reject 处理异常情况\r\n\t\treturn new Promise((resolve: (value?: unknown) => void, reject) => {\r\n\t\t\tnavigator.mediaDevices\r\n\t\t\t\t.getUserMedia({\r\n\t\t\t\t\taudio: true,\r\n\t\t\t\t\tvideo: true\r\n\t\t\t\t\t// video: {\r\n\t\t\t\t\t//     width: this.videoWidth,\r\n\t\t\t\t\t//     height: this.videoHeight\r\n\t\t\t\t\t// }\r\n\t\t\t\t})\r\n\t\t\t\t// 返回一个媒体内容的流\r\n\t\t\t\t.then(stream => {\r\n\t\t\t\t\t// 检测是否支持 srcObject，该属性在新的浏览器支持\r\n\t\t\t\t\tif ('srcObject' in this.video) {\r\n\t\t\t\t\t\tthis.video.srcObject = stream;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 兼容旧的浏览器\r\n\t\t\t\t\t\t// this.video.src = window.URL.createObjectURL(stream);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// 当视频的元数据已经加载时触发\r\n\t\t\t\t\tthis.video.addEventListener('loadmetadata', () => {\r\n\t\t\t\t\t\tthis.video.play();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.mediaRecorder = new MediaRecorder(stream);\r\n\t\t\t\t\t// TODO\r\n\t\t\t\t\tthis.mediaRecorder.addEventListener('dataavailable', (e: Event & { data: any }) => {\r\n\t\t\t\t\t\tthis.chunks.push(e.data);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t})\r\n\t\t\t\t// 异常抓取，包括用于禁用麦克风、摄像头\r\n\t\t\t\t.catch(error => {\r\n\t\t\t\t\treject(error);\r\n\t\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 视频开始录制\r\n\t */\r\n\tstartRecord() {\r\n\t\tif (this.mediaRecorder.state === 'inactive') {\r\n\t\t\tthis.mediaRecorder.start();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 视频结束录制\r\n\t */\r\n\tstopRecord() {\r\n\t\tif (this.mediaRecorder.state === 'recording') {\r\n\t\t\tthis.mediaRecorder.stop();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 检测当前浏览器对否支持\r\n\t *\r\n\t * @return {boolean} 当前浏览器是否支持\r\n\t */\r\n\tasync isSupport() {\r\n\t\t// TODO\r\n\t\tconst flag = navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\r\n\t\tif (await flag()) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n}\r\n","<template>\r\n\t<div :style=\"styleName\" class=\"basic-video\">\r\n\t\t<div class=\"basic-video__border\">\r\n\t\t\t<span :style=\"borderStyleName\"></span>\r\n\t\t\t<span :style=\"borderStyleName\"></span>\r\n\t\t\t<span :style=\"borderStyleName\"></span>\r\n\t\t\t<span :style=\"borderStyleName\"></span>\r\n\t\t</div>\r\n\t\t<img :style=\"imgStyleName\" class=\"basic-video__img\" :src=\"background\" />\r\n\t\t<video class=\"basic-video__main\" ref=\"main\" autoplay muted></video>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\" setup name=\"basic-video\">\r\nimport { computed, Ref, ref } from 'vue';\r\nimport RecordVideo from './plugin';\r\nconst main: Ref<HTMLAudioElement | undefined> = ref();\r\nconst emit = defineEmits<{ (e: 'data-change', value: string | ArrayBuffer | null): void }>();\r\nconst props = defineProps({\r\n\tbackground: {\r\n\t\ttype: String\r\n\t},\r\n\twidth: {\r\n\t\ttype: Number,\r\n\t\tdefault: 500\r\n\t}\r\n});\r\nconst styleName = computed(() => {\r\n\treturn {\r\n\t\twidth: `${props.width}px`\r\n\t};\r\n});\r\nconst imgStyleName = computed(() => {\r\n\treturn {\r\n\t\twidth: `${props.width / 2}px`\r\n\t};\r\n});\r\nconst borderStyleName = computed(() => {\r\n\treturn {\r\n\t\twidth: `${props.width / 15}px`,\r\n\t\theight: `${props.width / 15}px`,\r\n\t\tborderWidth: `${5}px`\r\n\t};\r\n});\r\nconst videoObj = ref();\r\nconst init = () => {\r\n\tvideoObj.value = new RecordVideo(main.value);\r\n\tconst videoPromise = videoObj.value.init();\r\n\tvideoPromise.then(() => {\r\n\t\tvideoObj.value.mediaRecorder.addEventListener('stop', getData, false);\r\n\t});\r\n};\r\n// const startRecord = () => {\r\n// \tvideoObj.value.startRecord();\r\n// };\r\n// const stopRecord = () => {\r\n// \tvideoObj.value.stopRecord();\r\n// };\r\nconst getData = () => {\r\n\tconst blob = new Blob(videoObj.value.chunks, {\r\n\t\ttype: 'video/mp4'\r\n\t});\r\n\tconst reader = new FileReader();\r\n\treader.readAsDataURL(blob);\r\n\treader.addEventListener('loadend', () => {\r\n\t\tlet video_base64 = reader.result;\r\n\t\temit('data-change', video_base64);\r\n\t});\r\n};\r\n\r\ninit();\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.basic-video {\r\n\tposition: relative;\r\n\tmargin: 0 auto;\r\n\toverflow: hidden;\r\n\t&__border {\r\n\t\tspan {\r\n\t\t\tposition: absolute;\r\n\t\t\twidth: 30px;\r\n\t\t\theight: 30px;\r\n\t\t\tcolor: #0073eb;\r\n\t\t\tborder-style: solid;\r\n\t\t\tborder-width: 4px;\r\n\t\t\t&:nth-child(1) {\r\n\t\t\t\ttop: 15px;\r\n\t\t\t\tleft: 15px;\r\n\t\t\t\tborder-right: 0;\r\n\t\t\t\tborder-bottom: 0;\r\n\t\t\t}\r\n\t\t\t&:nth-child(2) {\r\n\t\t\t\ttop: 15px;\r\n\t\t\t\tright: 15px;\r\n\t\t\t\tborder-bottom: 0;\r\n\t\t\t\tborder-left: 0;\r\n\t\t\t}\r\n\t\t\t&:nth-child(3) {\r\n\t\t\t\tbottom: 15px;\r\n\t\t\t\tleft: 15px;\r\n\t\t\t\tborder-top: 0;\r\n\t\t\t\tborder-right: 0;\r\n\t\t\t}\r\n\t\t\t&:nth-child(4) {\r\n\t\t\t\tright: 15px;\r\n\t\t\t\tbottom: 15px;\r\n\t\t\t\tborder-top: 0;\r\n\t\t\t\tborder-left: 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t&__img {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\twidth: 100px;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t}\r\n\t&__main {\r\n\t\twidth: 100%;\r\n\t}\r\n}\r\n</style>\r\n"],"names":["RecordVideo","constructor","videoObj","__publicField","this","video","mediaRecorder","chunks","init","Promise","resolve","reject","navigator","mediaDevices","getUserMedia","audio","then","stream","srcObject","addEventListener","play","MediaRecorder","e","push","data","catch","error","startRecord","state","start","stopRecord","stop","async","flag","main","Vue","ref","styleName","width","props","imgStyleName","borderStyleName","height","borderWidth","getData","blob","Blob","value","type","reader","FileReader","readAsDataURL","video_base64","result","emit"],"mappings":"wMAAA,MAAqBA,EASpBC,YAAYC,GARZC,EAAAC,KAAA,SACAD,EAAAC,KAAA,iBACAD,EAAAC,KAAA,UAOCA,KAAKC,MAAQH,EACbE,KAAKE,cAAgB,KACrBF,KAAKG,OAAS,GAQfC,OAIC,OAAO,IAAIC,SAAQ,CAACC,EAAoCC,KACvDC,UAAUC,aACRC,aAAa,CACbC,OAAO,EACPV,OAAO,IAOPW,MAAeC,IAEX,cAAeb,KAAKC,QACvBD,KAAKC,MAAMa,UAAYD,GAOnBb,KAAAC,MAAMc,iBAAiB,gBAAgB,KAC3Cf,KAAKC,MAAMe,UAEPhB,KAAAE,cAAgB,IAAIe,cAAcJ,GAEvCb,KAAKE,cAAca,iBAAiB,iBAAkBG,IAChDlB,KAAAG,OAAOgB,KAAKD,EAAEE,gBAKpBC,OAAeC,IACff,EAAOe,SAQXC,cACkC,aAA7BvB,KAAKE,cAAcsB,OACtBxB,KAAKE,cAAcuB,QAOrBC,aACkC,cAA7B1B,KAAKE,cAAcsB,OACtBxB,KAAKE,cAAcyB,OASrBC,kBAEC,MAAMC,EAAOrB,UAAUC,cAAgBD,UAAUC,aAAaC,aAC1D,SAAMmB,IACF,OAAA,oPCzEVC,EAAAC,IAAAC,MAWAC,EAAAF,mBACA,CAAAG,MAAA,GAAAC,EAAAD,cAIAE,EAAAL,mBACA,CAAAG,MAAAC,EAAAD,MAAA,EAAA,SAIAG,EAAAN,mBACA,CAAAG,MAAAC,EAAAD,MAAA,GAAA,KACAI,OAAAH,EAAAD,MAAA,GAAA,KACAK,YAAA,UAIAzC,EAAAiC,IAAAC,MAcAQ,EAAA,KACA,MAAAC,EAAA,IAAAC,KAAA5C,EAAA6C,MAAAxC,OAAA,CAAAyC,KAAA,cAGAC,EAAA,IAAAC,WACAD,EAAAE,cAAAN,GACAI,EAAA9B,iBAAA,WAAA,KACA,IAAAiC,EAAAH,EAAAI,OACAC,EAAA,cAAAF,aArBA,MACAlD,EAAA6C,MAAA,IAAA/C,EAAAkC,EAAAa,OACA7C,EAAA6C,MAAAvC,OACAQ,MAAA,KACAd,EAAA6C,MAAAzC,cAAAa,iBAAA,OAAAyB,GAAA"}