{"version":3,"file":"codelogin.488588e7.js","sources":["../../src/page/login/codelogin.vue"],"sourcesContent":["<template>\r\n\t<el-form class=\"login-form\" status-icon :rules=\"loginRules\" ref=\"loginForm\" :model=\"loginForm\" label-width=\"0\">\r\n\t\t<el-form-item prop=\"phone\">\r\n\t\t\t<el-input @keyup.enter=\"handleLogin\" v-model=\"loginForm.phone\" auto-complete=\"off\" :placeholder=\"$t('login.phone')\">\r\n\t\t\t\t<template #prefix>\r\n\t\t\t\t\t<i class=\"icon-shouji\"></i>\r\n\t\t\t\t</template>\r\n\t\t\t</el-input>\r\n\t\t</el-form-item>\r\n\t\t<el-form-item prop=\"code\">\r\n\t\t\t<el-input @keyup.enter=\"handleLogin\" v-model=\"loginForm.code\" auto-complete=\"off\" :placeholder=\"$t('login.code')\">\r\n\t\t\t\t<template #prefix>\r\n\t\t\t\t\t<i class=\"icon-yanzhengma\"></i>\r\n\t\t\t\t</template>\r\n\t\t\t\t<template #append>\r\n\t\t\t\t\t<span @click=\"handleSend\" class=\"msg-text\" :class=\"[{ display: msgKey }]\">{{ msgText }}</span>\r\n\t\t\t\t</template>\r\n\t\t\t</el-input>\r\n\t\t</el-form-item>\r\n\t\t<el-form-item>\r\n\t\t\t<el-button type=\"primary\" @click.prevent=\"handleLogin\" class=\"login-submit\">{{ $t('login.submit') }}</el-button>\r\n\t\t</el-form-item>\r\n\t</el-form>\r\n</template>\r\n\r\n<script lang=\"ts\" setup name=\"CodeLogin\">\r\nimport { isvalidatemobile } from 'utils/validate';\r\n// import { tagsStore } from '../../store/tags';\r\nimport { computed, reactive, ref } from 'vue';\r\nimport { FormInstance } from 'element-plus';\r\n// import { useRouter } from 'vue-router';\r\n// import { userStore } from '../../store/user';\r\nimport { useI18n } from 'app/lang/index';\r\n// const tStore = tagsStore();\r\n// const router = useRouter();\r\n// const uStore = userStore();\r\nconst i18n = useI18n();\r\nconst validatePhone = (rule: unknown, value: string, callback: (error?: Error) => void) => {\r\n\tif (isvalidatemobile(value)[0]) {\r\n\t\tcallback(new Error(isvalidatemobile(value)[1].toString()));\r\n\t} else {\r\n\t\tcallback();\r\n\t}\r\n};\r\nconst validateCode = (rule: unknown, value: string, callback: (error?: Error) => void) => {\r\n\tif (value.length != 4) {\r\n\t\tcallback(new Error('请输入4位数的验证码'));\r\n\t} else {\r\n\t\tcallback();\r\n\t}\r\n};\r\nconst msgText = ref('');\r\nconst msgTime = ref(0);\r\nconst msgKey = ref(false);\r\nlet loginForm = reactive({\r\n\tphone: '',\r\n\tcode: ''\r\n});\r\n\r\nconst loginRules = {\r\n\tphone: [{ required: true, trigger: 'blur', validator: validatePhone }],\r\n\tcode: [{ required: true, trigger: 'blur', validator: validateCode }]\r\n};\r\n\r\nconst config = computed(() => {\r\n\treturn {\r\n\t\t//TODO $t 已注册在全局，此取法有待优化\r\n\t\tMSGINIT: i18n.$t('login.msgText'),\r\n\t\tMSGSCUCCESS: i18n.$t('login.msgSuccess'),\r\n\t\tMSGTIME: 60\r\n\t};\r\n});\r\n// ...mapState(tagsStore(), ['tagWel']),\r\nmsgText.value = config.value.MSGINIT;\r\nmsgTime.value = config.value.MSGTIME;\r\n\r\nconst handleSend = () => {\r\n\tif (msgKey.value) return;\r\n\tmsgText.value = msgTime.value + config.value.MSGSCUCCESS;\r\n\tmsgKey.value = true;\r\n\tconst time = setInterval(() => {\r\n\t\tmsgTime.value--;\r\n\t\tmsgText.value = msgTime.value + config.value.MSGSCUCCESS;\r\n\t\tif (msgTime.value == 0) {\r\n\t\t\tmsgTime.value = config.value.MSGTIME;\r\n\t\t\tmsgText.value = config.value.MSGINIT;\r\n\t\t\tmsgKey.value = false;\r\n\t\t\tclearInterval(time);\r\n\t\t}\r\n\t}, 1000);\r\n};\r\n\r\nconst handleLogin = async (formEl: FormInstance | undefined) => {\r\n\tif (!formEl) return;\r\n\tawait formEl.validate((valid: boolean) => {\r\n\t\tif (valid) {\r\n\t\t\t// uStore.LoginByPhone(loginForm).then(() => {\r\n\t\t\t// \trouter.push(tStore.getTagWel);\r\n\t\t\t// });\r\n\t\t}\r\n\t});\r\n};\r\n</script>\r\n\r\n<style>\r\n.msg-text {\r\n\tdisplay: block;\r\n\twidth: 60px;\r\n\tfont-size: 12px;\r\n\ttext-align: center;\r\n\tcursor: pointer;\r\n}\r\n.msg-text.display {\r\n\tcolor: #ccc;\r\n}\r\n</style>\r\n"],"names":["i18n","useI18n","msgText","Vue","msgTime","msgKey","loginForm","reactive","phone","code","loginRules","required","trigger","validator","rule","value","callback","isvalidatemobile","Error","toString","length","config","MSGINIT","$t","MSGSCUCCESS","MSGTIME","handleSend","time","setInterval","clearInterval","handleLogin","async","formEl","validate","valid"],"mappings":"gQAoCA,MAAAA,EAAAC,IAeAC,EAAAC,YACAC,EAAAD,WACAE,EAAAF,YACA,IAAAG,EAAAH,IAAAI,SAAA,CAAAC,MAAA,GACAC,KAAA,KAIA,MAAAC,EAAA,CAAAF,MAAA,CAAA,CAAAG,UAAA,EAAAC,QAAA,OAAAC,UAtBA,CAAAC,EAAAC,EAAAC,KACAC,EAAAF,GAAA,GACAC,EAAA,IAAAE,MAAAD,EAAAF,GAAA,GAAAI,oBAqBAV,KAAA,CAAA,CAAAE,UAAA,EAAAC,QAAA,OAAAC,UAhBA,CAAAC,EAAAC,EAAAC,KACA,GAAAD,EAAAK,OACAJ,EAAA,IAAAE,MAAA,uBAkBAG,EAAAlB,mBACA,CAAAmB,QAAAtB,EAAAuB,GAAA,iBAEAC,YAAAxB,EAAAuB,GAAA,oBACAE,QAAA,OAKAvB,EAAAa,MAAAM,EAAAN,MAAAO,QACAlB,EAAAW,MAAAM,EAAAN,MAAAU,QAEA,MAAAC,EAAA,KACA,GAAArB,EAAAU,MAAA,OACAb,EAAAa,MAAAX,EAAAW,MAAAM,EAAAN,MAAAS,YACAnB,EAAAU,OAAA,EACA,MAAAY,EAAAC,aAAA,KACAxB,EAAAW,QACAb,EAAAa,MAAAX,EAAAW,MAAAM,EAAAN,MAAAS,YACA,GAAApB,EAAAW,QACAX,EAAAW,MAAAM,EAAAN,MAAAU,QACAvB,EAAAa,MAAAM,EAAAN,MAAAO,QACAjB,EAAAU,OAAA,EACAc,cAAAF,MACA,MAIAG,EAAAC,MAAAC,IACAA,SACAA,EAAAC,UAAAC"}