{"version":3,"mappings":"sDA0BA,WAAoBA,GACd,IAACC,EAASD,GACL,SAIL,MAAME,EAAWF,GACrB,MA5BY,qBA4BLG,GA3BI,8BA2BcA,GA7BZ,0BA6B6BA,GA1B7B,kBA0BgDA,ECJ/D,gFACAC,6bASO,oDC3BP,8CD2BO,KACN,wCACAC,iCACA,QAAaC,IAAIC,QACjB,MAAWD,IAAIC,QACfC,EAAaF,IAASG,aACtBC,EAAiBJ,IAAIC,QACrBI,EAAUL,IAASG,aACnBG,EAAyCN,IAAIC,MAC7CM,EAAcP,YACd,QAAaA,IAAIC,eACPO,QACHC,UAMPC,EAAgBV,mBACf,CAAOC,WACDU,eACcC,aACRC,yBAIbC,EAAgBd,mBACf,CAAO,gBACS,mBACG,aACN,eACE,YACH,mBACO,iBACF,sBAIlBe,EAAef,kBACdW,iBAEDK,cACCZ,uBAEDL,cACCM,WAID,aAyBCY,iBACCN,eAzBD,MACCJ,WACA,qEACAW,WACAb,+BAGE,MADAE,WAGCK,EADDD,MACCA,cAEAQ,OAEDC,qCACA,6BACAF,UACAD,gBACCN,kBACDU,cAGAd,mBASJe,YAiBCX,aACCA,cAhBAY,yCACAlB,uCAGEM,WACCA,cAEAa,6CAEIC,oBAWTC,cAiBCf,gBACCA,iBAhBAY,yCACAlB,6CAGEM,cACCA,iBAEAa,6CAEIC,oBAWTE,UACC,aACCtB,4CAECM,WACCA,kBAEAa,0CAIHb,aACCA,mBAGaa,oEAAgDI,uBACzCC,sBACDC,iBACZC,mBAMTC,UACCC,OAEAb,uBAGDc,YAGAC,MACCf,kBACAA,oBAGDgB,MACChB,uBAKD,OAFAV,eAEA,qECnMD2B,mCAKArC,oBACAM","names":["value","isObject","baseGetTag","tag","apiObj","apiO","Vue","ref","params","reactive","avueOption","api","crud","loading","size","total","bindVal","option","data","tableLoading","onEvent","rowKey","optionO","isFunction","list","res","page","finally","rowSave","Reflect","ElementPlus","catch","rowUpdate","rowDel","confirmButtonText","cancelButtonText","type","then","searchChange","done","refreshChange","sizeChange","currentChange","useCrud"],"sources":["../../node_modules/lodash-es/isFunction.js","../../src/hooks/useCrud.ts","../../src/views/util/crud.vue"],"sourcesContent":["import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import { ref, Ref, reactive, computed } from 'vue';\r\nimport { ElMessage, ElMessageBox } from 'element-plus';\r\nimport { isFunction } from 'lodash-es';\r\n\r\ninterface CrudOption {\r\n\trowKey?: string;\r\n\tsourcePath: string;\r\n\t// api: any;\r\n\t// option: any;\r\n\r\n\tlist?: string;\r\n\tadd?: string;\r\n\tupdate?: string;\r\n\tdel?: string;\r\n\r\n\tres?: (data: any) => any;\r\n\r\n\tlistAfter?: (data: any[]) => void;\r\n\tlistBefore?: () => void;\r\n\taddAfter?: (data?: any[]) => void;\r\n\taddBefore?: () => void;\r\n\tupdateAfter?: (data?: any[]) => void;\r\n\tupdateBefore?: () => void;\r\n\tdelAfter?: (data: any, row: any, index: number) => void;\r\n\tdelBefore?: () => void;\r\n\r\n\ttotalKey?: string;\r\n\tdataKey?: string;\r\n}\r\nlet optionObj = import.meta.glob(`../option/**/**`);\r\nlet apiObj = import.meta.glob(`../api/**/**`);\r\n// let optionO = optionObj[`../option/${option.sourcePath}.ts`];\r\n// let apiO = apiObj[`../api/${option.sourcePath}.ts`];\r\n// import * as api from '@/api/crud/index';\r\n// import avueOption from '@/option/crud/index';\r\n\r\n/**\r\n * 表单基本逻辑\r\n */\r\nexport const useCrud = (option: CrudOption) => {\r\n\tlet optionO = optionObj[`../option/${option.sourcePath}.ts`];\r\n\tlet apiO = apiObj[`../api/${option.sourcePath}.ts`];\r\n\tconst list = ref([]);\r\n\tlet form = ref({});\r\n\tlet params = reactive({});\r\n\tlet avueOption = ref({});\r\n\tlet api = reactive({});\r\n\tlet crud: Ref<HTMLElement | undefined> = ref();\r\n\tlet loading = ref(false);\r\n\tconst page = ref({\r\n\t\tcurrent: 1,\r\n\t\tsize: 20,\r\n\t\ttotal: 0\r\n\t});\r\n\r\n\tconsole.log(api);\r\n\r\n\tconst bindVal = computed(() => {\r\n\t\treturn {\r\n\t\t\tref: 'crud',\r\n\t\t\toption: avueOption.value,\r\n\t\t\tdata: list.value,\r\n\t\t\ttableLoading: loading.value\r\n\t\t};\r\n\t});\r\n\tconst onEvent = computed(() => {\r\n\t\treturn {\r\n\t\t\t'size-change': sizeChange,\r\n\t\t\t'current-change': currentChange,\r\n\t\t\t'row-save': rowSave,\r\n\t\t\t'row-update': rowUpdate,\r\n\t\t\t'row-del': rowDel,\r\n\t\t\t'refresh-change': refreshChange,\r\n\t\t\t'search-reset': searchChange,\r\n\t\t\t'search-change': searchChange\r\n\t\t};\r\n\t});\r\n\tconst rowKey = computed(() => {\r\n\t\treturn option.rowKey || 'id';\r\n\t});\r\n\toptionO().then(mode => {\r\n\t\tavueOption.value = mode.default();\r\n\t});\r\n\tapiO().then(mode => {\r\n\t\tapi = mode;\r\n\t\tgetList();\r\n\t});\r\n\t// * 分页数据请求\r\n\tconst getList = () => {\r\n\t\tconst callback = () => {\r\n\t\t\tloading.value = true;\r\n\t\t\tconst paramsObj = Object.assign({ current: page.value.current, size: page.value.size }, params);\r\n\t\t\tlist.value = [];\r\n\t\t\tapi[option.list || 'list'](paramsObj)\r\n\t\t\t\t.then((res: any) => {\r\n\t\t\t\t\tloading.value = false;\r\n\t\t\t\t\tlet data;\r\n\t\t\t\t\tif (option.res) {\r\n\t\t\t\t\t\tdata = option.res(res.data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdata = res.data;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tpage.value.total = data[option.totalKey || 'total'];\r\n\t\t\t\t\tconst result = data[option.dataKey || 'data'];\r\n\t\t\t\t\tlist.value = result;\r\n\t\t\t\t\tif (isFunction(option.listAfter)) {\r\n\t\t\t\t\t\toption.listAfter(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.finally(() => {\r\n\t\t\t\t\tloading.value = false;\r\n\t\t\t\t});\r\n\t\t};\r\n\t\tif (isFunction(option.listBefore)) {\r\n\t\t\toption.listBefore();\r\n\t\t}\r\n\t\tcallback();\r\n\t};\r\n\t// * 数据保存请求\r\n\tconst rowSave = (row: any, done: () => void, loading: () => void) => {\r\n\t\tconst callback = () => {\r\n\t\t\tReflect.deleteProperty(form.value, 'params');\r\n\t\t\tapi[option.add || 'add'](form.value)\r\n\t\t\t\t.then((data: any) => {\r\n\t\t\t\t\tgetList();\r\n\t\t\t\t\tif (option.addAfter) {\r\n\t\t\t\t\t\toption.addAfter(data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tElMessage.success('新增成功');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdone();\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tloading();\r\n\t\t\t\t});\r\n\t\t};\r\n\t\tif (option.addBefore) {\r\n\t\t\toption.addBefore();\r\n\t\t}\r\n\t\tcallback();\r\n\t};\r\n\tconst rowUpdate = (row: any, index: number, done: () => void, loading: () => void) => {\r\n\t\tconst callback = () => {\r\n\t\t\tReflect.deleteProperty(form.value, 'params');\r\n\t\t\tapi[option.update || 'update'](form.value)\r\n\t\t\t\t.then((data: any) => {\r\n\t\t\t\t\tgetList();\r\n\t\t\t\t\tif (option.updateAfter) {\r\n\t\t\t\t\t\toption.updateAfter(data);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tElMessage.success('更新成功');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdone();\r\n\t\t\t\t})\r\n\t\t\t\t.catch(() => {\r\n\t\t\t\t\tloading();\r\n\t\t\t\t});\r\n\t\t};\r\n\t\tif (option.updateBefore) {\r\n\t\t\toption.updateBefore();\r\n\t\t}\r\n\t\tcallback();\r\n\t};\r\n\tconst rowDel = (row: any, index: number) => {\r\n\t\tconst callback = () => {\r\n\t\t\tapi[option.del || 'del'](row[rowKey.value], row).then((data: any) => {\r\n\t\t\t\tgetList();\r\n\t\t\t\tif (option.delAfter) {\r\n\t\t\t\t\toption.delAfter(data, row, index);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tElMessage.success('删除成功');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\tif (option.delBefore) {\r\n\t\t\toption.delBefore();\r\n\t\t\tcallback();\r\n\t\t} else {\r\n\t\t\tElMessageBox.confirm(`此操作将永久删除序号【${index}】的数据, 是否继续?`, '提示', {\r\n\t\t\t\tconfirmButtonText: '确定',\r\n\t\t\t\tcancelButtonText: '取消',\r\n\t\t\t\ttype: 'warning'\r\n\t\t\t}).then(() => {\r\n\t\t\t\tcallback();\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\tconst searchChange = (params: any, done: () => void) => {\r\n\t\tif (done) done();\r\n\t\tparams = params;\r\n\t\tpage.value.current = 1;\r\n\t\tgetList();\r\n\t};\r\n\tconst refreshChange = () => {\r\n\t\tgetList();\r\n\t};\r\n\tconst sizeChange = (val: number) => {\r\n\t\tpage.value.current = 1;\r\n\t\tpage.value.size = val;\r\n\t\tgetList();\r\n\t};\r\n\tconst currentChange = (val: number) => {\r\n\t\tpage.value.current = val;\r\n\t\tgetList();\r\n\t};\r\n\tconsole.log('-=-=-=-=-=', bindVal.value.option);\r\n\r\n\treturn { bindVal, onEvent, rowKey, crud, refreshChange, page, form };\r\n};\r\n","<template>\r\n\t<basic-container>\r\n\t\t<avue-crud v-bind=\"bindVal\" v-on=\"onEvent\" v-model:page=\"page\" v-model=\"form\"> </avue-crud>\r\n\t</basic-container>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { useCrud } from '@/hooks/useCrud';\r\nimport { onMounted } from 'vue';\r\n// import { getCurrentInstance, onMounted } from 'vue';\r\n// const instance = getCurrentInstance();\r\n\r\nlet { bindVal, onEvent, page, form, crud } = useCrud({\r\n\t// api,\r\n\t// option: option(),\r\n\tsourcePath: 'crud/index'\r\n});\r\nonMounted(() => {\r\n\tconsole.log(crud.value);\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"],"file":"assets/crud.070b98be.js"}